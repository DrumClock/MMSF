# ------------------------------------------------------------------

[manual_stepper manual_0]
step_pin: MMSF:PD15
dir_pin:  MMSF:PA1
enable_pin:  !MMSF:PA3
microsteps: 16
rotation_distance: 24
velocity: 5
accel:  0
endstop_pin: ^MMSF:PB2


[tmc2209 manual_stepper manual_0]	
uart_pin:  MMSF:PD8
run_current: 0.800
stealthchop_threshold: 500


# ---------------------------------------------------------------

[gcode_macro MANUAL_LOAD]
gcode:  
       SET_SERVO SERVO=switching_0  angle=45
       G4 P300  
       SET_SERVO SERVO=switching_0   WIDTH=0
       G4 P300 
       
#-----------------------------------------------------------------------------------------------------
    ### load filament to end_stop pin      
       MANUAL_STEPPER STEPPER=manual_0  ENABLE=1
       MANUAL_STEPPER STEPPER=manual_0  SET_POSITION=0  MOVE=90  SPEED=30  STOP_ON_ENDSTOP=-1
    ### load filament to extruder   
       MANUAL_STEPPER STEPPER=manual_0  SET_POSITION=0  MOVE=120   SPEED=30  SYNC=0
       M83
       G1 E60 F1800
       G1 E60
       MANUAL_STEPPER STEPPER=manual_0  ENABLE=0
#-----------------------------------------------------------------------------------------------------

       SET_SERVO SERVO=switching_0  angle=90
       G4 P300  
       SET_SERVO SERVO=switching_0   WIDTH=0
       G4 P300 

######################################################################################
       
[gcode_macro MANUAL_UNLOAD]
gcode:  
       SET_SERVO SERVO=switching_0  angle=45
       G4 P300  
       SET_SERVO SERVO=switching_0   WIDTH=0
       G4 P300 
       
#-----------------------------------------------------------------------------------------------------
       ### unload filament from extruder
       MANUAL_STEPPER STEPPER=manual_0  ENABLE=1
       MANUAL_STEPPER STEPPER=manual_0  SET_POSITION=0  MOVE=-80  SPEED=30  SYNC=0  
       M83
       G1 E-40 F1800   
       G1 E-40 F1800       
       ### unload filament to end_stop pin
       MANUAL_STEPPER STEPPER=manual_0  SET_POSITION=0  MOVE=-80  SPEED=30  STOP_ON_ENDSTOP=1   
       ### unload filament to park position
       MANUAL_STEPPER STEPPER=manual_0  SET_POSITION=0  MOVE=-80   SPEED=30       
       MANUAL_STEPPER STEPPER=manual_0  ENABLE=0
#-----------------------------------------------------------------------------------------------------
 
       SET_SERVO SERVO=switching_0  angle=90
       G4 P300  
       SET_SERVO SERVO=switching_0   WIDTH=0
       G4 P300 






        